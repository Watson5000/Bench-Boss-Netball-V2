<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="theme-color" content="#111111" />
<title>Bench Boss: Netball (V2)</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="favicon.png" type="image/png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">

<style>
:root{--pad:12px;--r:14px;--b:1px solid #ddd}
body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial;background:#f6f6f6}
header{padding:calc(var(--pad)+2px);color:#fff;background:linear-gradient(135deg,#0b0b0b 0%,#121212 45%,#1a1a1a 100%);box-shadow:0 10px 24px rgba(0,0,0,.18)}
header h1{margin:0;font-size:18px}
main{padding:var(--pad);display:grid;gap:var(--pad)}
.card{background:#fff;border:var(--b);border-radius:var(--r);padding:var(--pad)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.grow{flex:1}
.seg{display:flex;gap:8px;flex-wrap:wrap}
.seg button{border:var(--b);background:#fff;padding:10px 12px;border-radius:999px;font-weight:900}
.seg button.active{background:#111;color:#fff;border-color:#111}
button.primary{background:#111;color:#fff;border:1px solid #111;border-radius:12px;padding:12px 14px;font-weight:900}
button.ghost{background:#fff;border:var(--b);border-radius:12px;padding:12px 14px;font-weight:900}
button.small{padding:8px 10px;border-radius:10px;font-weight:900}
button.danger{border-color:#c62828;color:#c62828}
input,select,textarea{border:var(--b);border-radius:12px;padding:10px 12px;font-size:16px}
textarea{width:100%;min-height:70px}
.muted{color:#666;font-size:13px}
.list{display:grid;gap:8px}
.pill{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border:var(--b);border-radius:12px}
.modalBack{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:9999}
.modal{background:#fff;border:1px solid #ddd;border-radius:16px;padding:14px;width:min(900px,100%)}
table{width:100%;border-collapse:collapse}
th,td{border:var(--b);padding:8px 10px}
th{background:#fafafa}
.miniDanger{border:1px solid #c62828;color:#c62828;background:#fff;border-radius:10px;padding:8px 10px;font-weight:900}
.scoreBig{font-size:40px;font-weight:900}
.divider{height:1px;background:#eee;margin:10px 0}
</style>
</head>
<body>

<header>
  <div class="row">
    <h1 class="grow">Bench Boss: Netball <span class="muted">(V2)</span></h1>
  </div>
</header>

<main>
  <!-- Welcome -->
  <section class="card" id="welcomeCard">
    <div style="font-weight:900;font-size:18px">Welcome ðŸ‘‹</div>
    <div class="muted" style="margin-top:6px">
      Start by creating a <b>Competition</b>. The format is locked once created.
    </div>
    <div style="height:10px"></div>
    <button class="primary" id="welcomeStartBtn">Create competition</button>
  </section>

  <!-- Competition / Team -->
  <section class="card" id="topCard" style="display:none">
    <div class="row">
      <div class="grow">
        <div class="muted">Competitions</div>
        <div class="seg" id="compSeg"></div>
      </div>
      <button class="primary small" id="addCompBtn">+ Add Comp</button>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div class="grow">
        <div class="muted">Competition</div>
        <input id="compName" disabled>
      </div>
      <div class="grow">
        <div class="muted">Format</div>
        <div id="formatLabel" style="font-weight:900">â€”</div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div class="grow">
        <div class="muted">Teams</div>
        <div class="seg" id="teamSeg"></div>
      </div>
      <button class="primary small" id="addTeamBtn">+ Add Team</button>
    </div>

    <div style="height:10px"></div>
    <div class="row">
      <div class="grow">
        <div class="muted">Team name</div>
        <input id="teamName">
      </div>
    </div>
  </section>

  <!-- Players -->
  <section class="card" id="playersCard" style="display:none">
    <div class="row">
      <div class="grow">
        <div style="font-weight:900">Players</div>
        <div class="muted">Edit via popup (name + 2 preferred positions)</div>
      </div>
      <button class="primary small" id="editPlayersBtn">Edit players</button>
    </div>
    <div style="height:10px"></div>
    <div class="list" id="playersQuickList"></div>
  </section>

  <!-- Game / Scoring (stub for now) -->
  <section class="card" id="gameStub" style="display:none">
    <div class="row">
      <div class="grow">
        <div style="font-weight:900">Game & Scoring</div>
        <div class="muted">Scoring, timer and OT will be verified next.</div>
      </div>
    </div>
    <div style="height:10px"></div>
    <div class="row" style="justify-content:space-between">
      <div>
        <div class="scoreBig">0</div>
        <div class="muted">Home</div>
      </div>
      <div>
        <div class="scoreBig">0</div>
        <div class="muted">Away</div>
      </div>
    </div>
  </section>
</main>

<!-- Competition Modal -->
<div class="modalBack" id="compBack">
  <div class="modal">
    <div class="row">
      <h3 class="grow">Create Competition</h3>
      <button class="ghost small" onclick="closeComp()">Close</button>
    </div>
    <div class="muted">Format is locked once created.</div>
    <div style="height:10px"></div>
    <input id="newCompName" placeholder="Competition name">
    <div style="height:10px"></div>
    <label><input type="radio" name="newCompFormat" value="quarters" checked> 4 quarters</label>
    <label style="margin-left:10px"><input type="radio" name="newCompFormat" value="halves"> 2 halves</label>
    <div style="height:12px"></div>
    <button class="primary" onclick="createComp()">Create</button>
  </div>
</div>

<!-- Players Modal -->
<div class="modalBack" id="playersBack">
  <div class="modal">
    <div class="row">
      <h3 class="grow">Players</h3>
      <button class="ghost small" onclick="closePlayers()">Close</button>
    </div>
    <div class="muted">Name + two preferred positions.</div>
    <div style="height:10px"></div>
    <table>
      <thead><tr><th>#</th><th>Name</th><th>Pos 1</th><th>Pos 2</th><th></th></tr></thead>
      <tbody id="playersBody"></tbody>
    </table>
    <div class="row" style="margin-top:10px">
      <button class="ghost small" onclick="addPlayerRow()">+ Row</button>
      <div class="grow"></div>
      <button class="primary small" onclick="savePlayers()">Save</button>
    </div>
  </div>
</div>

<script>
const POSITIONS=["GS","GA","WA","C","WD","GD","GK"];
const APP_KEY="bb_v2_singlefile_clean";
let app=JSON.parse(localStorage.getItem(APP_KEY)||"{}");
if(!app.competitions) app={competitions:[],currentComp:null};

function save(){localStorage.setItem(APP_KEY,JSON.stringify(app));}
function show(el){el.style.display="block"} function hide(el){el.style.display="none"}
function hasComp(){return app.competitions.length>0}
function comp(){return app.competitions.find(c=>c.id===app.currentComp)}
function team(){return comp()?comp().teams.find(t=>t.id===comp().currentTeam):null}

function init(){
  if(!hasComp()){show(welcomeCard);openComp()}
  else{
    hide(welcomeCard);
    show(topCard);show(playersCard);show(gameStub);
    render();
  }
}

function openComp(){show(compBack);setTimeout(()=>newCompName.focus(),0)}
function closeComp(){hide(compBack)}
function createComp(){
  const name=newCompName.value.trim();
  if(!name){alert("Enter a competition name");return}
  const format=[...document.querySelectorAll('input[name="newCompFormat"]')].find(r=>r.checked).value;
  const c={id:crypto.randomUUID(),name,format,teams:[],currentTeam:null};
  app.competitions=[c];app.currentComp=c.id;save();closeComp();init();
}

function render(){
  const c=comp();
  compName.value=c.name;formatLabel.textContent=c.format;
  renderTeams();renderPlayers();
}

function renderTeams(){
  const c=comp();
  const seg=document.getElementById("teamSeg");seg.innerHTML="";
  c.teams.forEach(t=>{
    const b=document.createElement("button");
    b.textContent=t.name;b.className=(t.id===c.currentTeam)?"active":"";
    b.onclick=()=>{c.currentTeam=t.id;save();render();};
    seg.appendChild(b);
  });
}

addTeamBtn.onclick=()=>{
  const c=comp();
  const t={id:crypto.randomUUID(),name:"Team "+(c.teams.length+1),players:[]};
  c.teams.push(t);c.currentTeam=t.id;save();render();
};

editPlayersBtn.onclick=()=>{openPlayersModal(team()?.players||[])}

let playersDraft=[];
function openPlayersModal(players){
  playersDraft=JSON.parse(JSON.stringify(players));
  if(playersDraft.length===0) addPlayerRow();
  renderPlayersTable();show(playersBack);
}
function closePlayers(){hide(playersBack)}
function addPlayerRow(){playersDraft.push({id:crypto.randomUUID(),name:"",pos1:"",pos2:""});renderPlayersTable()}
function renderPlayersTable(){
  playersBody.innerHTML="";
  playersDraft.forEach((p,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${i+1}</td>
      <td><input value="${p.name}"></td>
      <td>${sel(p.pos1)}</td>
      <td>${sel(p.pos2)}</td>
      <td><button class="miniDanger">âˆ’</button></td>`;
    const [n,s1,s2]=tr.querySelectorAll("input,select");
    n.oninput=e=>p.name=e.target.value;
    s1.onchange=e=>p.pos1=e.target.value;
    s2.onchange=e=>p.pos2=e.target.value;
    tr.querySelector("button").onclick=()=>{playersDraft.splice(i,1);renderPlayersTable()}
    playersBody.appendChild(tr);
  })
}
function sel(v){return `<select>${['<option value="">â€”</option>'].concat(POSITIONS.map(x=>`<option ${x===v?"selected":""}>${x}</option>`)).join("")}</select>`}
function savePlayers(){
  const t=team();t.players=playersDraft.filter(p=>p.name.trim()!=="");save();closePlayers();renderPlayers();
}
function renderPlayers(){
  playersQuickList.innerHTML="";
  if(!team()) return;
  team().players.forEach(p=>{
    const d=document.createElement("div");d.className="pill";
    d.innerHTML=`<div><b>${p.name}</b><div class="muted">Pref: ${p.pos1||"â€”"}${p.pos2?" / "+p.pos2:""}</div></div>`;
    playersQuickList.appendChild(d);
  })
}

welcomeStartBtn.onclick=openComp;
addCompBtn.onclick=openComp;

init();
</script>
</body>
</html>