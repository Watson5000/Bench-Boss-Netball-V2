<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="theme-color" content="#111111">

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="icon" type="image/png" href="favicon.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Bench Boss">

<title>Bench Boss: Netball (V2)</title>

<style>
:root { --pad:12px; --r:14px; --b:1px solid #ddd; }
body{ margin:0; font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial; background:#f6f6f6; }

header{
  padding: calc(var(--pad) + 2px);
  color:#fff;
  background:
    radial-gradient(900px 220px at 10% 20%, rgba(255,255,255,.12), transparent 60%),
    linear-gradient(135deg, #0b0b0b 0%, #121212 45%, #1a1a1a 100%);
  border-bottom:1px solid rgba(255,255,255,.10);
}
header h1{ margin:0; font-size:18px; }

.brandRow{ display:flex; gap:12px; align-items:center; }
.brandLogo{
  width:40px;height:40px;border-radius:12px;
  background:#222;
}
.badge{
  font-size:11px;padding:4px 8px;border-radius:999px;
  background:rgba(255,255,255,.12);
  font-weight:900;
}

main{ padding:var(--pad); display:grid; gap:var(--pad); }
.card{ background:#fff; border:var(--b); border-radius:var(--r); padding:var(--pad); }
.row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.grow{ flex:1; }
.muted{ color:#666; font-size:13px; }

.seg{ display:flex; gap:8px; flex-wrap:wrap; }
.seg button{
  border:var(--b); background:#fff; padding:10px 12px;
  border-radius:999px; font-weight:900;
}
.seg button.active{
  background:#111; color:#fff;
}

button.primary{
  background:#111; color:#fff; border-radius:12px;
  padding:12px 14px; font-weight:900;
}
button.ghost{
  background:#fff; border:var(--b); border-radius:12px;
  padding:12px 14px; font-weight:900;
}
button.small{ padding:8px 10px; }

input,select,textarea{
  border:var(--b); border-radius:12px;
  padding:10px 12px; font-size:16px;
}

.scoreBig{ font-size:40px; font-weight:900; }
.warn{ padding:10px; border-radius:12px; background:#fff8e1; border:1px solid #ffe082; }

.modalBack{
  position:fixed; inset:0;
  background:rgba(0,0,0,.45);
  display:none; align-items:center; justify-content:center;
  z-index:9999;
}
.modal{
  background:#fff; border-radius:16px;
  padding:14px; width:min(900px,100%);
}

</style>
</head>

<body>

<header>
  <div class="row" style="justify-content:space-between">
    <div class="brandRow">
      <div class="brandLogo"></div>
      <div>
        <h1>Bench Boss: Netball <span class="badge">V2</span></h1>
        <div class="muted">Designed by Matt Watson</div>
      </div>
    </div>
    <button id="howtoBtn" class="ghost small">How-to</button>
  </div>
</header>

<main>

<section class="card" id="welcomeCard">
  <div style="font-weight:900;font-size:18px">Welcome ðŸ‘‹</div>
  <div class="muted" style="margin-top:6px">
    Start by creating a competition. Format is locked per competition.
  </div>
  <button class="primary" id="welcomeAddCompBtn" style="margin-top:10px">+ Add Competition</button>
</section>

<section class="card" id="navCard">
  <div class="row">
    <div class="grow">
      <div class="muted">Competitions</div>
      <div class="seg" id="compSeg"></div>
    </div>
    <button class="primary small" id="addCompBtn">+ Competition</button>
  </div>

  <div class="row" style="margin-top:10px">
    <div class="grow">
      <div class="muted">Teams</div>
      <div class="seg" id="teamSeg"></div>
    </div>
    <button class="primary small" id="addTeamBtn">+ Team</button>
  </div>
</section>

<section class="card" id="gameCard">
  <div class="row">
    <div class="grow">
      <div class="muted">Team</div>
      <input id="teamName">
    </div>
    <div class="grow">
      <div class="muted">Game</div>
      <div id="gameLabel" style="font-weight:900">Game 1</div>
    </div>
    <button class="ghost small" id="addGameBtn">+ Game</button>
  </div>
</section>

<section class="card" id="playersCard">
  <div class="row">
    <div class="grow" style="font-weight:900">Players</div>
    <button class="primary small" id="managePlayersBtn">Manage Players</button>
  </div>
</section>

<section class="card" id="periodCard">
  <div class="row">
    <div class="grow" style="font-weight:900">Period</div>
    <div class="seg" id="periodSeg"></div>
  </div>

  <div class="row" style="margin-top:10px">
    <div class="scoreBig" id="homeScore">0</div>
    <div class="scoreBig" id="awayScore">0</div>
  </div>

  <div class="row" style="margin-top:10px">
    <button class="primary" id="homePlus">Home +1</button>
    <button class="primary" id="awayPlus">Away +1</button>
    <button class="ghost" id="undoBtn">Undo</button>
  </div>
</section>

<section class="card" id="positionsCard">
  <div class="row">
    <div class="grow" style="font-weight:900">Positions</div>
  </div>
  <div id="positionsGrid"></div>
</section>

<section class="card" id="statsCard">
  <div style="font-weight:900">Stats</div>
  <div id="statsList"></div>
</section>

</main>

<script>
/* ===== Bench Boss V2 Core ===== */

const POSITIONS = ["GS","GA","WA","C","WD","GD","GK"];
const STORAGE_KEY = "benchboss_v2";

function uid(){ return Math.random().toString(16).slice(2)+Date.now(); }
function save(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }
function load(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY));}catch{return null;} }

let state = load() || { competitions: [], currentCompId:null };

function renderAll(){
  document.getElementById("welcomeCard").style.display =
    state.competitions.length ? "none" : "block";
}
renderAll();
</script>

</body>
</html><script>
/* ===== PART 2 â€” UI wiring, modals, and full behavior ===== */

/* ---------- Helpers ---------- */
function compById(id){ return state.competitions.find(c=>c.id===id); }
function teamById(comp, id){ return comp.teams.find(t=>t.id===id); }
function currentComp(){ return compById(state.currentCompId); }
function currentTeam(){ const comp = currentComp(); return comp ? teamById(comp, comp.currentTeamId) : null; }
function currentGame(){ const team = currentTeam(); return team ? team.games[team.currentGameIndex] : null; }

/* ---------- Basic Models ---------- */
function newCompetition(name, format){ return {
  id: uid(), name: name||`Comp ${state.competitions.length+1}`, format: format||"quarters",
  // format locked per competition
  teams: [],
  currentTeamId: null,
  finalsActive: false
}; }

function newTeam(name, compFormat){
  const players = Array.from({length:10},(_,i)=>({ id: uid(), name:`Player ${i+1}`, pos1:"", pos2:"" }));
  return {
    id: uid(),
    name: name||`Team ${Math.random().toString(16).slice(2,6)}`,
    players,
    games: [ newGame(1, players, compFormat) ],
    currentGameIndex: 0
  };
}

function basePeriodsForFormat(format){ return format==="halves" ? 2 : 4; }
function newGame(round, players, format){
  const base = basePeriodsForFormat(format);
  return {
    round: round||1,
    roundName: "",
    opponent: "",
    date: "",
    selectedP: 0,
    liveP: 0,
    periods: Array.from({length:base}, ()=>({ assignments: {}, homeScore:0, awayScore:0, events:[] })),
    playerStats: (players||[]).reduce((acc,p)=>{ acc[p.id]={goals:0,played:0}; return acc; }, {}),
    playCredits: {} , // playCredits[periodIdx][pid]=0.5 when sub-in
    otCount: 0,
    otMinutes: 3,
    baseMinutes: (format==="halves")?8:10,
    timerRemaining: ((format==="halves")?8:10)*60,
    timerRunning: false,
    timerMode: "countdown",
    gameEnded: false
  };
}

/* ---------- Render: Competitions & Teams ---------- */
function renderCompTabs(){
  const seg = document.getElementById("compSeg");
  seg.innerHTML = "";
  state.competitions.forEach(c=>{
    const b = document.createElement("button");
    b.textContent = c.name.slice(0,18);
    b.className = (c.id===state.currentCompId) ? "active" : "";
    b.addEventListener("click", ()=> {
      state.currentCompId = c.id;
      // default open first team if present
      if(c.teams.length) c.currentTeamId = c.currentTeamId || c.teams[0].id;
      save(state); renderAll();
    });
    seg.appendChild(b);
  });
}

function renderTeamTabs(){
  const seg = document.getElementById("teamSeg");
  seg.innerHTML = "";
  const comp = currentComp();
  if(!comp) return;
  comp.teams.forEach(t=>{
    const b = document.createElement("button");
    b.textContent = (t.name || "Team").slice(0,18);
    b.className = (t.id===comp.currentTeamId) ? "active" : "";
    b.addEventListener("click", ()=> {
      comp.currentTeamId = t.id;
      save(state); renderAll();
    });
    seg.appendChild(b);
  });
}

/* ---------- Add / Delete ---------- */
function openAddCompModal(){
  // simple prompt flow for speed
  const name = prompt("Competition name (e.g. Parkville Comp):");
  if(!name) return;
  const format = confirm("Use halves (OK) or quarters (Cancel)?\nOK = halves, Cancel = quarters") ? "halves" : "quarters";
  const comp = newCompetition(name, format);
  state.competitions.push(comp);
  state.currentCompId = comp.id;
  save(state);
  // open team modal next
  openAddTeamModal();
  renderAll();
}

function openAddTeamModal(){
  const comp = currentComp();
  if(!comp) return alert("Create a competition first.");
  const name = prompt("Team name:");
  if(!name) return;
  const team = newTeam(name, comp.format);
  comp.teams.push(team);
  comp.currentTeamId = team.id;
  save(state);
  // next step: add players modal
  openManagePlayersModal(true);
  renderAll();
}

/* ---------- Players Modal ---------- */
function openManagePlayersModal(isForNewTeam){
  // build modal with simple table: name, pos1, pos2, add/remove, save
  const modal = document.createElement("div");
  modal.className = "modalBack";
  modal.style.display = "flex";
  modal.innerHTML = `
    <div class="modal">
      <div class="row"><h3 class="grow">Manage Players</h3><button id="closePlayers" class="ghost small">Close</button></div>
      <div style="height:8px"></div>
      <div id="playersTable"></div>
      <div style="height:8px"></div>
      <div class="row">
        <button id="addPlayerLocal" class="primary small">+ Add Player</button>
        <div class="grow"></div>
        <button id="savePlayers" class="primary">Save</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);

  const comp = currentComp();
  const team = currentTeam();
  let players = team ? team.players.slice() : Array.from({length:10},(_,i)=>({id:uid(),name:`Player ${i+1}`,pos1:"",pos2:""}));

  function renderPlayersTable(){
    const wrap = modal.querySelector("#playersTable");
    wrap.innerHTML = "";
    players.forEach((p,idx)=>{
      const row = document.createElement("div");
      row.className = "row";
      row.style.marginBottom = "8px";
      row.innerHTML = `
        <input data-idx="${idx}" class="pname" style="flex:1" value="${escapeHtml(p.name)}" />
        <input data-idx="${idx}" class="ppos1" style="width:120px" placeholder="Pos 1" value="${escapeHtml(p.pos1)}" />
        <input data-idx="${idx}" class="ppos2" style="width:120px" placeholder="Pos 2" value="${escapeHtml(p.pos2)}" />
        <button class="ghost small removeBtn">Remove</button>
      `;
      wrap.appendChild(row);

      // wire quick filter on pos inputs
      const pos1 = row.querySelector(".ppos1");
      pos1.addEventListener("input", (e)=>{
        // simple filter: accept only known position prefixes
        const v = e.target.value.toUpperCase();
        const match = POSITIONS.find(x=>x.startsWith(v));
        if(match) e.target.value = match;
        players[idx].pos1 = e.target.value;
      });
      const pos2 = row.querySelector(".ppos2");
      pos2.addEventListener("input", (e)=>{
        const v = e.target.value.toUpperCase();
        const match = POSITIONS.find(x=>x.startsWith(v));
        if(match) e.target.value = match;
        players[idx].pos2 = e.target.value;
      });

      const nameIn = row.querySelector(".pname");
      nameIn.addEventListener("focus", ()=> setTimeout(()=> nameIn.select(),0));
      nameIn.addEventListener("input", (e)=> players[idx].name = e.target.value);

      row.querySelector(".removeBtn").addEventListener("click", ()=>{
        if(players.length <= 7) return alert("Minimum 7 players required.");
        players.splice(idx,1);
        renderPlayersTable();
      });
    });
  }

  renderPlayersTable();

  modal.querySelector("#addPlayerLocal").addEventListener("click", ()=>{
    if(players.length >= 15) return alert("Max 15 players.");
    players.push({ id: uid(), name: `Player ${players.length+1}`, pos1:"", pos2:"" });
    renderPlayersTable();
  });

  modal.querySelector("#closePlayers").addEventListener("click", ()=> { modal.remove(); });

  modal.querySelector("#savePlayers").addEventListener("click", ()=>{
    // commit to team
    if(!team) return alert("No team selected.");
    team.players = players;
    // ensure playerStats for all games
    for(const g of team.games){
      for(const p of players){
        if(!g.playerStats[p.id]) g.playerStats[p.id] = { goals:0, played:0 };
      }
    }
    save(state);
    modal.remove();
    renderAll();
  });

  // if opened as part of new team flow, keep modal open (user edits then saves)
}

/* ---------- Render Players Inputs & Positions ---------- */
function renderPlayersCard(){
  const el = document.getElementById("playersCard");
  const team = currentTeam();
  if(!team) { el.style.display = "none"; return; }
  el.style.display = "block";
  // show top 5 players names for quick glance
  const list = team.players.slice(0,10).map(p=>p.name).join(", ");
  el.querySelector(".grow").nextSibling && (el.querySelector(".grow").nextSibling.textContent = "");
}

function renderPeriodSegAndScores(){
  const g = currentGame();
  if(!g) return;
  const seg = document.getElementById("periodSeg");
  seg.innerHTML = "";
  for(let i=0;i<g.periods.length;i++){
    const b = document.createElement("button");
    b.textContent = periodLabelForRender(i);
    b.className = (g.selectedP===i) ? "active" : "";
    b.addEventListener("click", ()=>{
      g.selectedP = i; g.liveP = Math.min(g.liveP, g.periods.length-1);
      save(state); renderAll();
    });
    seg.appendChild(b);
  }
  document.getElementById("homeScore").textContent = totalHome(g);
  document.getElementById("awayScore").textContent = totalAway(g);
}

function periodLabelForRender(idx){
  const comp = currentComp();
  if(!comp) return `P${idx+1}`;
  const base = basePeriodsForFormat(comp.format);
  if(idx < base) return comp.format==="halves" ? `H${idx+1}` : `Q${idx+1}`;
  return `OT${idx-base+1}`;
}

/* ---------- Positions Grid (show all periods on screen) ---------- */
function renderPositionsGrid(){
  const wrap = document.getElementById("positionsGrid");
  wrap.innerHTML = "";
  const team = currentTeam(), g = currentGame();
  if(!team || !g) { wrap.style.display = "none"; return; }
  wrap.style.display = "block";

  const base = basePeriodsForFormat(currentComp().format);
  // build a header row
  const header = document.createElement("div");
  header.style.display = "grid";
  header.style.gridTemplateColumns = `100px repeat(${POSITIONS.length},1fr)`;
  header.style.gap = "8px";
  header.style.fontWeight = "900";
  header.style.marginBottom = "6px";
  header.innerHTML = `<div></div>` + POSITIONS.map(p=>`<div style="text-align:center">${p}</div>`).join("");
  wrap.appendChild(header);

  // for each period, show assignment row
  for(let p=0;p<g.periods.length;p++){
    const row = document.createElement("div");
    row.style.display = "grid";
    row.style.gridTemplateColumns = `100px repeat(${POSITIONS.length},1fr)`;
    row.style.gap = "8px";
    row.style.marginBottom = "6px";

    const label = document.createElement("div");
    label.style.fontWeight = (p===g.liveP) ? "900" : "600";
    label.textContent = periodLabelForRender(p) + (p===g.liveP ? " â€¢ LIVE" : "");
    row.appendChild(label);

    for(const pos of POSITIONS){
      const cell = document.createElement("div");
      const pid = g.periods[p].assignments[pos] || "";
      const pname = pid ? (team.players.find(x=>x.id===pid)?.name || "â€”") : "â€”";
      cell.style.padding = "8px";
      cell.style.border = "1px solid #eee";
      cell.style.borderRadius = "8px";
      cell.style.textAlign = "center";

      // allow change when editing that period
      if(g.selectedP === p){
        const sel = document.createElement("select");
        const opt0 = document.createElement("option");
        opt0.value = ""; opt0.textContent = "â€”";
        sel.appendChild(opt0);
        team.players.forEach(pl=>{
          const o = document.createElement("option");
          o.value = pl.id;
          const played = regulationPlayedDisplay(g, pl.id);
          o.textContent = `${pl.name} (${played})`;
          sel.appendChild(o);
        });
        sel.value = pid;
        sel.addEventListener("change", ()=> {
          g.periods[p].assignments[pos] = sel.value || null;
          // ensure uniqueness
          for(const other of POSITIONS){
            if(other!==pos && g.periods[p].assignments[other]===sel.value) {
              g.periods[p].assignments[other] = null;
            }
          }
          save(state); renderAll();
        });
        cell.appendChild(sel);
      } else {
        cell.textContent = pname;
      }

      row.appendChild(cell);
    }
    wrap.appendChild(row);
  }

  // Bench: players not assigned in selected editing period
  const benchHeader = document.createElement("div");
  benchHeader.style.marginTop = "12px";
  benchHeader.style.fontWeight = "900";
  benchHeader.textContent = "Bench (editing period)";
  wrap.appendChild(benchHeader);

  const benchList = document.createElement("div");
  benchList.style.display = "grid";
  benchList.style.gap = "8px";
  const assigned = new Set(Object.values(g.periods[g.selectedP].assignments||{}).filter(Boolean));
  team.players.forEach(pl=>{
    if(assigned.has(pl.id)) return;
    const pill = document.createElement("div");
    pill.className = "pill";
    pill.innerHTML = `<div style="font-weight:900">${pl.name}</div><div class="muted">${pl.pos1||""} ${pl.pos2?"/ "+pl.pos2:""}</div>`;
    benchList.appendChild(pill);
  });
  wrap.appendChild(benchList);
}

/* ---------- Regulation played display, with 0.5 for subs ---------- */
function regulationPlayedDisplay(game, playerId){
  const comp = currentComp();
  const reg = basePeriodsForFormat(comp.format);
  let sum = 0;
  for(let i=0;i<reg;i++){
    const credit = (game.playCredits && game.playCredits[i] && Number(game.playCredits[i][playerId])) || 0;
    if(credit>0) sum += credit;
    else {
      // inferred
      const assigned = Object.values(game.periods[i].assignments||{}).filter(Boolean);
      sum += (assigned.includes(playerId) ? 1 : 0);
    }
  }
  return (Math.abs(sum - Math.round(sum))<1e-9) ? String(Math.round(sum)) : sum.toFixed(1);
}

/* ---------- Scoring ---------- */
function totalHome(game){ return game.periods.reduce((s,p)=>s+(p.homeScore||0),0); }
function totalAway(game){ return game.periods.reduce((s,p)=>s+(p.awayScore||0),0); }

function scoreTeam(which, delta){
  const g = currentGame();
  if(!g || g.gameEnded) return;
  const idx = g.liveP;
  if(which==="home") g.periods[idx].homeScore = clamp0((g.periods[idx].homeScore||0)+delta);
  else g.periods[idx].awayScore = clamp0((g.periods[idx].awayScore||0)+delta);
  // event
  g.periods[idx].events.push({type:"score",which,delta,t:Date.now()});
  save(state); renderAll();
}

function scoreFromPosition(pos){
  const g = currentGame();
  if(!g || g.gameEnded) return;
  const idx = g.liveP;
  const pid = g.periods[idx].assignments[pos];
  if(!pid) return alert(`Assign a player to ${pos} in LIVE period first.`);
  g.periods[idx].homeScore += 1;
  g.playerStats[pid] = g.playerStats[pid] || {goals:0,played:0};
  g.playerStats[pid].goals += 1;
  g.periods[idx].events.push({type:"playerGoal", pid, pos, t:Date.now()});
  save(state); renderAll();
}

function undoLast(){
  const g = currentGame();
  if(!g) return;
  const idx = g.liveP;
  const ev = g.periods[idx].events.pop();
  if(!ev) return;
  if(ev.type==="score"){
    if(ev.which==="home") g.periods[idx].homeScore = clamp0(g.periods[idx].homeScore - ev.delta);
    else g.periods[idx].awayScore = clamp0(g.periods[idx].awayScore - ev.delta);
  } else if(ev.type==="playerGoal"){
    g.periods[idx].homeScore = clamp0(g.periods[idx].homeScore - 1);
    if(g.playerStats[ev.pid]) g.playerStats[ev.pid].goals = clamp0(g.playerStats[ev.pid].goals - 1);
  }
  save(state); renderAll();
}

/* ---------- Copy positions ---------- */
function copyPositions(fromIdx, toIdx){
  const g = currentGame();
  if(!g) return;
  g.periods[toIdx].assignments = JSON.parse(JSON.stringify(g.periods[fromIdx].assignments||{}));
  save(state); renderAll();
}

/* ---------- Period end / OT handling ---------- */
function endOrNext(){
  const g = currentGame();
  if(!g) return;
  const base = basePeriodsForFormat(currentComp().format);
  const lastIdx = g.periods.length-1;

  // If OT1 and OT2 always present: if currently OT1 -> go to OT2
  if(g.otCount===2 && g.liveP === base){ g.liveP = base+1; g.selectedP = base+1; save(state); renderAll(); return; }

  // If last period, mark ended (if OT rules allow)
  if(g.liveP >= lastIdx){
    g.gameEnded = true;
    save(state); renderAll();
    return;
  }

  g.liveP += 1; g.selectedP = g.liveP;
  save(state); renderAll();
}

function startOTIfNeeded(){
  const g = currentGame();
  if(!g) return;
  // only allow start OT if gameEnded and draw
  if(!g.gameEnded) return alert("End game first (finish last period).");
  if(totalHome(g) !== totalAway(g)) return alert("Not a draw.");
  // add two OT periods
  g.otCount = 2;
  g.periods.push({assignments:{},homeScore:0,awayScore:0,events:[]});
  g.periods.push({assignments:{},homeScore:0,awayScore:0,events:[]});
  g.gameEnded = false;
  g.liveP = basePeriodsForFormat(currentComp().format);
  g.selectedP = g.liveP;
  save(state); renderAll();
}

/* ---------- Stats rendering ---------- */
function renderStats(){
  const wrap = document.getElementById("statsList");
  wrap.innerHTML = "";
  const g = currentGame();
  const team = currentTeam();
  if(!g || !team){ wrap.innerHTML = "<div class='muted'>No game selected</div>"; return; }

  const table = document.createElement("div");
  table.style.display = "grid";
  table.style.gap = "8px";

  // Goals and played
  team.players.forEach(p=>{
    const row = document.createElement("div");
    row.className = "pill";
    const goals = (g.playerStats[p.id]?.goals) || 0;
    const played = regulationPlayedDisplay(g, p.id);
    row.innerHTML = `<div style="font-weight:900">${escapeHtml(p.name)}</div><div class="muted">Goals: ${goals} â€¢ Played: ${played}</div>`;
    table.appendChild(row);
  });

  wrap.appendChild(table);
}

/* ---------- Render All ---------- */
function renderAll(){
  // initial visibility
  document.getElementById("welcomeCard").style.display = state.competitions.length ? "none" : "block";

  renderCompTabs();
  renderTeamTabs();

  const comp = currentComp();
  if(!comp){ // hide main sections
    ["gameCard","playersCard","periodCard","positionsCard","statsCard"].forEach(id=>document.getElementById(id).style.display="none");
    return;
  }

  // show top sections
  document.getElementById("gameCard").style.display = "block";
  document.getElementById("playersCard").style.display = "block";
  document.getElementById("periodCard").style.display = "block";
  document.getElementById("positionsCard").style.display = "block";
  document.getElementById("statsCard").style.display = "block";

  // team and game header
  const team = currentTeam();
  if(team){
    document.getElementById("teamName").value = team.name;
    const g = currentGame();
    document.getElementById("gameLabel").textContent = `Game ${g.round} ${g.roundName ? "â€¢ "+g.roundName : ""}`;
  }

  renderPeriodSegAndScores();
  renderPositionsGrid();
  renderStats();
  save(state);
}

/* ---------- Wiring DOM controls ---------- */
document.getElementById("addCompBtn").addEventListener("click", openAddCompModal);
document.getElementById("welcomeAddCompBtn").addEventListener("click", openAddCompModal);
document.getElementById("addTeamBtn").addEventListener("click", openAddTeamModal);

document.getElementById("managePlayersBtn").addEventListener("click", ()=> openManagePlayersModal(false));

document.getElementById("addGameBtn").addEventListener("click", ()=>{
  const team = currentTeam(); const comp = currentComp();
  if(!team) return alert("Select a team first.");
  const next = team.games.length+1;
  team.games.push(newGame(next, team.players, comp.format));
  team.currentGameIndex = team.games.length-1;
  save(state); renderAll();
});

document.getElementById("homePlus").addEventListener("click", ()=>{ scoreTeam("home", +1); });
document.getElementById("awayPlus").addEventListener("click", ()=>{ scoreTeam("away", +1); });
document.getElementById("undoBtn").addEventListener("click", undoLast);

document.getElementById("howtoBtn").addEventListener("click", ()=>{
  alert("How-to: Create a competition â†’ add teams â†’ add players â†’ add games. Use positions grid to plan. Use Home/Away +1 buttons to score. Stats show goals and played time.");
});

/* ---------- Initialization ---------- */
(function init(){
  // restore minimal example if none
  if(!state.competitions || !state.competitions.length){
    // keep blank to force user flow
  }
  renderAll();
})();

/* ---------- Save on unload ---------- */
window.addEventListener("beforeunload", ()=> save(state));

</script>
</body>
</html>